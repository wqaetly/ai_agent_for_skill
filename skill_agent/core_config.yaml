# skill_agent Core Configuration
# 纯 RAG 逻辑配置，无 MCP/Unity/WebUI 依赖
# 版本: 1.1.0 (RAG 优化版)

# ==================== 嵌入模型配置 ====================
embedding:
  # Qwen3-Embedding-0.6B 本地模型（已下载完整权重）
  model_name: "Data/models/Qwen3-Embedding-0.6B"
  device: "cpu"  # 或 "cuda" 如果有 GPU
  batch_size: 32
  max_length: 8192  # Qwen3 支持 32K，设为 8192 平衡性能
  cache_dir: null  # null 使用系统默认缓存
  use_flash_attention: false  # CPU 不支持

  # 多级缓存配置 (v1.1.0 新增)
  cache_path: "Data/embedding_cache"  # 磁盘缓存路径，null 禁用磁盘缓存
  l1_cache_size: 2000  # L1 内存缓存大小

# ==================== 向量数据库配置 ====================
vector_store:
  type: "lancedb"  # LanceDB 嵌入式向量数据库（无需 Docker）
  lancedb_path: "Data/lancedb"  # 本地存储路径
  collection_name: "skill_collection"
  distance_metric: "cosine"  # cosine, l2, dot

# ==================== 技能索引配置 ====================
skill_indexer:
  # 技能文件目录（相对路径）
  skills_directory: "../ai_agent_for_skill/Assets/Skills"

  # 文件监听
  watch_enabled: true

  # 索引缓存
  index_cache: "Data/skill_index.json"

  # 索引字段
  index_fields:
    - "skillName"
    - "skillDescription"
    - "skillId"
    - "actions"

  # Action 详细信息索引
  index_action_details: true

  # 自动重建索引间隔（秒），0 表示仅在启动和文件变化时
  auto_reindex_interval: 0

# ==================== Action 索引配置 ====================
action_indexer:
  # Unity 导出的 Action JSON 文件目录
  actions_directory: "Data/Actions"

  # Action 索引缓存
  action_index_cache: "Data/action_index.json"

  # Action 向量 collection（独立于技能 collection）
  collection_name: "action_collection"

# ==================== RAG 检索配置 ====================
rag:
  # 检索参数
  top_k: 5  # 返回最相似的 K 个结果
  similarity_threshold: 0.1  # 相似度阈值（0-1），降低以提高召回率

  # 重排序配置 (v1.1.0 增强)
  rerank_enabled: true  # 启用重排序
  use_semantic_rerank: false  # 是否使用语义重排序（需要额外计算）
  use_cross_encoder: false  # 是否使用 Cross-Encoder（需要额外模型）

  # 混合检索配置 (v1.1.0 新增)
  hybrid_search:
    enabled: true  # 是否启用混合检索
    use_dynamic_weights: true  # 动态权重调整
    default_bm25_weight: 0.3  # 默认 BM25 权重
    default_vector_weight: 0.7  # 默认向量检索权重
    rrf_k: 60  # RRF 融合参数

  # 缓存配置
  cache_enabled: true
  cache_ttl: 3600  # 缓存生存时间（秒）

# ==================== 性能监控配置 (v1.1.0 新增) ====================
performance:
  enabled: true
  slow_threshold_ms: 500  # 慢查询阈值（毫秒）
  max_history: 1000  # 保留的历史记录数量

# ==================== 日志配置 ====================
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "Data/rag_core.log"
  max_bytes: 10485760  # 10MB
  backup_count: 3

  # 日志格式
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"
