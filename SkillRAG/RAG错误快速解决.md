# 🔧 RAG索引错误 - 快速解决方案

## ❌ 你遇到的错误

```
[RAG] 开始重建索引...
[18:37:22] [RAG异常] An error occurred while sending the request
```

---

## ✅ 最快解决方法（3步）

### 1️⃣ 打开RAG查询窗口
```
Unity菜单 > 技能系统 > RAG查询窗口
```

### 2️⃣ 启动服务器
```
点击窗口中的 [🚀 启动服务器] 按钮
等待5-10秒，直到显示 "✅ 服务器运行中"
```

### 3️⃣ 重新尝试
```
返回描述管理器
点击 [🔨 重建RAG索引]
```

---

## 🎯 问题原因

**RAG服务器未运行**

- RAG索引重建需要Python服务器运行
- 服务器默认地址: `http://127.0.0.1:8765`
- 服务器不会自动启动，需要手动启动

---

## 🆕 新增功能（已优化）

### 1. 服务器状态指示器

在描述管理器顶部可以看到：
- 🟢 RAG服务器: 运行中 ✅
- 🔴 RAG服务器: 未连接 ❌

### 2. 自动连接测试

点击"重建索引"前会自动检查服务器：
- ✅ 连接成功 → 继续重建
- ❌ 连接失败 → 显示详细提示

### 3. 测试连接按钮

新增 **🔍 测试服务器连接** 按钮：
- 快速检查服务器状态
- 不需要真正重建索引
- 提供详细的连接信息

### 4. 智能错误提示

现在错误提示会告诉你：
- ❌ 具体是什么问题
- 💡 为什么会出现这个问题
- 🔧 如何解决（分步骤）
- 📖 在哪里查看详细文档

---

## 📋 完整工作流程

### 正确的操作顺序

```
1. 启动Unity编辑器
   ↓
2. 打开 技能系统 > RAG查询窗口
   ↓
3. 点击 🚀 启动服务器
   ↓
4. 等待启动完成（看到 ✅ 服务器运行中）
   ↓
5. 打开 技能系统 > 描述管理器
   ↓
6. 使用各种功能（扫描、生成、编辑、保存、导出）
   ↓
7. 最后点击 🔨 重建RAG索引
```

---

## 💡 重要提示

### ✅ 不需要服务器的功能

以下功能**随时可用**，不需要RAG服务器：

- 🔍 扫描Actions
- 🤖 AI生成描述
- 📝 查看和编辑描述
- 💾 保存到数据库
- 📤 导出JSON文件
- 🔄 重新生成选中项
- 📂 打开文件/目录

### ❌ 需要服务器的功能

只有这个功能需要服务器运行：

- 🔨 重建RAG索引

---

## 🔍 如何确认服务器已启动？

### 方法1: 查看RAG查询窗口
```
状态显示: ✅ 服务器运行中
```

### 方法2: 查看描述管理器
```
统计信息区域显示: 🟢 RAG服务器: 运行中
```

### 方法3: 使用测试按钮
```
点击 🔍 测试服务器连接
看到 "✅ 连接成功" 对话框
```

### 方法4: 浏览器测试
```
打开浏览器访问: http://127.0.0.1:8765/health
看到 JSON响应: {"status": "ok", ...}
```

---

## 🚨 常见问题

### Q: 为什么每次都要启动服务器？

**A**: RAG服务器是独立的Python进程，不会随Unity自动启动。

**建议**: 
- 在开始工作时先启动服务器
- 服务器会一直运行，直到关闭Unity或手动停止

---

### Q: 服务器启动失败怎么办？

**可能原因**:
1. 端口8765被占用
2. Python环境问题
3. 依赖包未安装

**解决方法**:
1. 查看RAG查询窗口的日志
2. 打开 `RAG索引错误排查指南.md`
3. 按照指南逐步排查

---

### Q: 可以不用RAG功能吗？

**A**: 可以！

- 描述管理器的核心功能（扫描、生成、编辑、保存、导出）都不需要RAG
- RAG只用于语义搜索和智能推荐
- 如果不需要这些功能，可以跳过索引重建

---

## 📚 相关文档

### 详细文档
- **RAG索引错误排查指南.md** - 完整的故障排查步骤
- **描述管理器使用指南.md** - 工具使用说明
- **描述管理器快速参考.md** - 功能速查表

### 打开方式
```
在描述管理器中点击错误提示的 [查看排查指南] 按钮
或直接打开 SkillRAG/ 目录下的文档
```

---

## 🎉 总结

**90%的情况下，只需要3步**:

```
1. 打开RAG查询窗口
2. 启动服务器
3. 重试
```

**记住**: 
- 🟢 = 可以重建索引
- 🔴 = 需要先启动服务器

---

*最后更新: 2025-11-01*
*版本: v2.0 - 添加智能错误提示*
