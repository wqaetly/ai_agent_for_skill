# 描述管理器使用指南

## 📖 工具概述

**描述管理器（DescriptionManagerWindow）** 是一个用于管理Unity技能系统中Action描述的编辑器工具。它可以：
- 自动扫描项目中的所有Action类
- 使用AI生成Action的功能描述
- 管理和编辑描述数据库
- 导出JSON供RAG系统使用
- 触发RAG索引重建

## 🎯 使用流程

### 📊 统计信息
在顶部可以看到：
- **Action总数**：项目中所有Action的数量
- **已生成描述**：已有描述的Action数量
- **待生成**：还没有描述的Action数量

---

### 🔍 步骤1: 扫描Actions

**作用**：扫描项目中所有继承自`ISkillAction`的类，并从数据库加载已有的描述信息。

**操作**：
1. 点击 **"🔍 扫描所有Actions"** 按钮
2. 工具会自动：
   - 查找所有Action类型
   - 读取源代码
   - 从数据库加载已有描述
   - 显示在列表中

**何时使用**：
- 首次打开工具时（会自动执行）
- 添加了新的Action类后
- 想刷新列表时

---

### 🤖 步骤2: AI生成描述

**作用**：使用DeepSeek AI为Action自动生成功能描述、分类和搜索关键词。

**配置**：
- **DeepSeek API Key**：填入你的API密钥（默认已配置）

**操作选项**：

#### 2.1 生成所有缺失描述
- 点击 **"🤖 生成所有缺失描述"** 按钮
- 只会为还没有描述的Action生成
- 适合首次使用或批量生成

#### 2.2 重新生成选中项
- 在步骤3的列表中勾选要重新生成的Action
- 点击 **"🔄 重新生成选中项"** 按钮
- 会覆盖原有描述
- 适合对某些描述不满意，想重新生成

**注意事项**：
- AI生成需要时间，每个Action约1-2秒
- 生成过程中会显示进度条
- 生成失败的会在日志中显示原因

---

### 📝 步骤3: 查看和编辑Action列表

**作用**：查看所有Action的信息，手动编辑不满意的描述。

**列表字段说明**：
- **选择**：勾选框，用于批量操作
- **Action类型**：类名（只读）
- **显示名称**：在编辑器中显示的名称（可编辑）
- **分类**：Action的分类（可编辑）
- **功能描述**：详细的功能说明（可编辑）
- **状态**：
  - ⏳待生成：还没有描述
  - ✅AI生成：由AI生成的描述
  - ✏️手动：手动编辑的描述

**批量选择按钮**：
- **全选**：选中所有Action
- **全不选**：取消所有选择
- **反选**：反转当前选择状态
- **选择待生成**：只选择还没有描述的Action

**编辑技巧**：
- 可以直接在表格中修改任何字段
- 修改后记得点击步骤4保存
- 展开行可以看到更多信息（搜索关键词等）

---

### 💾 步骤4: 保存到数据库

**作用**：将编辑好的描述保存到`ActionDescriptionDatabase.asset`资源文件。

**操作**：
1. 点击 **"💾 保存所有到数据库"** 按钮
2. 所有有描述的Action会被保存
3. 数据库会自动清理已删除的Action

**查看数据库**：
- 点击 **"📂 打开数据库文件"** 按钮
- 会在Project窗口中定位到数据库文件
- 可以在Inspector中查看数据库内容

**数据库位置**：`Assets/Data/ActionDescriptionDatabase.asset`

---

### 📤 步骤5: 导出JSON文件

**作用**：将Action数据导出为JSON格式，供Python RAG系统使用。

**配置**：
- **导出目录**：JSON文件的保存位置（默认：`../SkillRAG/Data/Actions`）

**操作**：
1. 点击 **"📤 导出所有JSON"** 按钮
2. 每个Action会生成一个独立的JSON文件
3. 文件名格式：`ActionTypeName.json`

**查看导出结果**：
- 点击 **"📁 打开导出目录"** 按钮
- 会在文件浏览器中打开导出目录

**JSON文件内容**：
```json
{
  "version": "1.0",
  "exportTime": "2025-11-01T18:30:00",
  "action": {
    "typeName": "MoveAction",
    "displayName": "移动",
    "category": "Movement",
    "description": "控制角色移动...",
    "parameters": [...]
  }
}
```

---

### 🔨 步骤6: 重建RAG索引

**作用**：触发Python RAG服务器重建向量索引，使新的描述生效。

**前置条件**：
- ⚠️ RAG服务器必须正在运行
- 打开方式：`技能系统 > RAG查询窗口` → 启动服务器

**操作**：
1. 确保RAG服务器已启动
2. 点击 **"🔨 重建RAG索引"** 按钮
3. 等待索引重建完成（通常几秒钟）

**成功标志**：
- 弹出对话框显示索引数量和耗时
- 日志中显示"索引重建成功"

**失败处理**：
- 检查RAG服务器是否运行
- 查看日志中的错误信息
- 确认导出的JSON文件是否正确

---

## ⚡ 快捷操作

### 一键完成全流程
点击 **"⚡ 一键完成全流程"** 按钮，自动执行：
1. 扫描Actions
2. AI生成缺失描述
3. 保存到数据库
4. 导出JSON文件
5. 重建RAG索引

**适用场景**：
- 首次配置系统
- 添加了多个新Action后
- 想快速更新整个系统

**注意**：
- 需要RAG服务器运行中
- 过程可能需要几分钟
- 会弹出确认对话框

### 其他快捷按钮
- **🔄 刷新界面**：重新扫描并刷新显示
- **🗑️ 清空日志**：清空操作日志区域

---

## 📋 操作日志

在底部的日志区域可以看到：
- 每个操作的执行结果
- 成功/失败的详细信息
- 错误和警告信息
- 时间戳

**日志格式**：`[HH:mm:ss] [操作类型] 消息内容`

---

## 💡 使用建议

### 首次使用流程
1. 打开工具：`技能系统 > 描述管理器`
2. 检查统计信息，确认Action数量
3. 点击"生成所有缺失描述"
4. 在列表中检查生成结果
5. 手动修改不满意的描述
6. 保存到数据库
7. 导出JSON
8. 启动RAG服务器
9. 重建索引
10. 在RAG查询窗口测试搜索

### 日常维护流程
1. 添加新Action后，点击"扫描Actions"
2. 点击"选择待生成"按钮
3. 点击"生成所有缺失描述"
4. 检查并保存
5. 导出JSON
6. 重建索引

### 优化描述流程
1. 在列表中找到要优化的Action
2. 勾选它
3. 点击"重新生成选中项"
4. 或者直接在列表中手动编辑
5. 保存到数据库
6. 导出JSON
7. 重建索引

---

## ❓ 常见问题

### Q: 为什么有些Action没有生成描述？
A: 可能原因：
- 无法读取源代码文件
- API调用失败
- 网络问题
- 查看日志中的具体错误信息

### Q: 如何修改AI生成的描述？
A: 直接在步骤3的列表中编辑，然后保存到数据库即可。

### Q: 重建索引失败怎么办？
A: 
1. 确认RAG服务器是否运行
2. 检查导出目录中的JSON文件是否正确
3. 查看Python服务器的控制台输出

### Q: 可以只导出部分Action吗？
A: 目前会导出所有Action。如果需要，可以手动删除不需要的JSON文件。

### Q: 数据库文件丢失了怎么办？
A: 工具会自动创建新的数据库文件，但之前的描述会丢失。建议定期备份。

---

## 🔧 技术细节

### 数据流向
```
Unity Action类 
  → 扫描 → 内存列表 
  → AI生成 → 更新列表 
  → 保存 → ActionDescriptionDatabase.asset
  → 导出 → JSON文件
  → 索引 → Python RAG系统
```

### 文件位置
- 数据库：`Assets/Data/ActionDescriptionDatabase.asset`
- JSON导出：`../SkillRAG/Data/Actions/*.json`
- 工具脚本：`Assets/Scripts/RAGSystem/Editor/DescriptionManagerWindow.cs`

### API配置
- DeepSeek API：用于生成描述
- RAG服务器：默认 `http://localhost:8000`

---

## 📞 支持

如有问题，请查看：
1. 操作日志中的错误信息
2. Unity Console中的异常堆栈
3. Python RAG服务器的控制台输出
