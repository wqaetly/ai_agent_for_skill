#!/bin/bash
# Action规范检查Hook
# 检查是否有JSON文件使用了不存在的Action类型

echo "🔍 检查Action规范合规性..."

# 检查技能JSON文件
for json_file in $(find Assets/Skills -name "*.json" 2>/dev/null); do
    if [ -f "$json_file" ]; then
        echo "检查文件: $json_file"

        # 检查是否使用LogAction作为占位符（除了合法的日志用途）
        suspicious_log_usage=$(grep -c '"LogAction".*"message".*"Sound:\|Camera:\|Effect:"' "$json_file" 2>/dev/null || true)
        if [ "$suspicious_log_usage" -gt 0 ]; then
            echo "❌ 错误: $json_file 中发现LogAction被用作占位符"
            echo "请创建对应的专用Action类型"
            exit 1
        fi

        # 提取Action类型并检查是否存在对应的脚本文件
        action_types=$(grep -o '"[^"]*Action"' "$json_file" | sort -u | sed 's/"//g' 2>/dev/null || true)
        for action in $action_types; do
            script_file="Assets/Scripts/SkillSystem/Actions/${action}.cs"
            if [ ! -f "$script_file" ]; then
                echo "❌ 错误: 使用了不存在的Action类型: $action"
                echo "缺少文件: $script_file"
                exit 1
            fi
        done
    fi
done

echo "✅ Action规范检查通过"