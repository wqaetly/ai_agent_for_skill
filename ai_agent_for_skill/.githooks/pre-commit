#!/bin/bash
# Actionè§„èŒƒæ£€æŸ¥Hook
# æ£€æŸ¥æ˜¯å¦æœ‰JSONæ–‡ä»¶ä½¿ç”¨äº†ä¸å­˜åœ¨çš„Actionç±»å‹

echo "ğŸ” æ£€æŸ¥Actionè§„èŒƒåˆè§„æ€§..."

# æ£€æŸ¥æŠ€èƒ½JSONæ–‡ä»¶
for json_file in $(find Assets/Skills -name "*.json" 2>/dev/null); do
    if [ -f "$json_file" ]; then
        echo "æ£€æŸ¥æ–‡ä»¶: $json_file"

        # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨LogActionä½œä¸ºå ä½ç¬¦ï¼ˆé™¤äº†åˆæ³•çš„æ—¥å¿—ç”¨é€”ï¼‰
        suspicious_log_usage=$(grep -c '"LogAction".*"message".*"Sound:\|Camera:\|Effect:"' "$json_file" 2>/dev/null || true)
        if [ "$suspicious_log_usage" -gt 0 ]; then
            echo "âŒ é”™è¯¯: $json_file ä¸­å‘ç°LogActionè¢«ç”¨ä½œå ä½ç¬¦"
            echo "è¯·åˆ›å»ºå¯¹åº”çš„ä¸“ç”¨Actionç±»å‹"
            exit 1
        fi

        # æå–Actionç±»å‹å¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯¹åº”çš„è„šæœ¬æ–‡ä»¶
        action_types=$(grep -o '"[^"]*Action"' "$json_file" | sort -u | sed 's/"//g' 2>/dev/null || true)
        for action in $action_types; do
            script_file="Assets/Scripts/SkillSystem/Actions/${action}.cs"
            if [ ! -f "$script_file" ]; then
                echo "âŒ é”™è¯¯: ä½¿ç”¨äº†ä¸å­˜åœ¨çš„Actionç±»å‹: $action"
                echo "ç¼ºå°‘æ–‡ä»¶: $script_file"
                exit 1
            fi
        done
    fi
done

echo "âœ… Actionè§„èŒƒæ£€æŸ¥é€šè¿‡"